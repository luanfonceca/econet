{% extends "base.html" %}
{% load bootstrap3 %}

{% block extra_head %}
  <link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
  <!--[if lte IE 8]>
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->
  <style type="text/css">
    #map:hover {
      cursor: crosshair;
    }
  </style>
{% endblock extra_head %}

{% block content %}
  <!-- row is also an option -->
  <div class="row-fluid">
    <div id="map"></div>
  </div>

  <div id="id_block_add_marker" class="row col-lg-offset-3 col-lg-6 hide">
    <div class="well">
      <div class="page-header">
        <h1 id="type">Adicionar Ponto de Coleta</h1>
        <br>
        <div class="row col-lg-offset-2">
          <div class="col-lg-12">
            <div class="bs-example">
              <form class="bs-example form-horizontal" method="POST" action="{% url 'collect_spot_create' %}">
                {% csrf_token %}
                {% bootstrap_form form layout="horizontal" field_class="col-md-9" %}

                {% buttons %}
                  <div class="col-lg-offset-2 col-lg-10">
                    <input type="reset" class="btn btn-default" value="Cancelar" />
                    <input type="submit" class="btn btn-primary" value="Salvar" />
                  </div>
                {% endbuttons %}
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script src='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js'></script>
  <script type='text/javascript'>
    var map = L.mapbox.map('map', 'luanfonceca.map-705soe3f');
    
    map.on('click', function(e){
      $("#id_block_add_marker").removeClass("hide");
      
      $("#id_latitude").val(e.latlng.lat);
      $("#id_longitude").val(e.latlng.lng);
    });

    $("#id_block_add_marker").find('input[type="reset"]').on('click', function(e){
      $("#id_block_add_marker").addClass("hide");
    });
    
    L.mapbox.markerLayer()
      .loadURL('{% url "collect_spot_json" %}')
      .addTo(map);
  </script>
{% endblock %}
